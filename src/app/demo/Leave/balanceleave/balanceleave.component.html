<div class="page-content">
  <div class="leave-balance-container" #exportDiv id="exportContent">
    <div class="header-section">
      <div>
        <h2>Leave Balance</h2>
        <div class="employee-info">
          <div class="employee-name">
            {{ employeeName }}
            <span class="employee-code" *ngIf="employeeCode">({{ employeeCode }})</span>
          </div>
          <span class="report-date">{{ currentDate }}</span>
        </div>
      </div>
      <button class="export-button" (click)="exportToPDF()">
        <i class="bi bi-upload text-black" style="font-weight: 100;"></i> Export
      </button>
    </div>

    <div class="boxed-section cards-container mb-4" *ngIf="employeeName !== 'No Employee Selected' && employeeName !== 'Employee Not Found'">
      <div class="row g-4">
        <!-- Status Legend Card -->
        <div class="col-md-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">Status Legend</h5>
              <div class="d-flex flex-column gap-2">
                <div class="d-flex align-items-center">
                  <span class="badge bg-success me-2">&nbsp;</span>
                  <span>Approved</span>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-danger me-2">&nbsp;</span>
                  <span>Rejected</span>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-warning me-2">&nbsp;</span>
                  <span>Pending</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Handover Reason Card -->
        <div class="col-md-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">Handover Reason</h5>
              <p class="card-text text-muted">No handover reason provided</p>
            </div>
          </div>
        </div>

        <!-- Employee Name Card -->
        <div class="col-md-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">Employee</h5>
              <p class="card-text">{{ employeeName }}</p>
            </div>
          </div>
        </div>

        <!-- Additional Info Card -->
        <div class="col-md-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">Report Date</h5>
              <p class="card-text">{{ currentDate }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="boxed-section history-container" *ngIf="employeeName !== 'No Employee Selected' && employeeName !== 'Employee Not Found'">
      <div class="section-header">
        <h3>Leave Request History</h3>
        <div class="header-right-group">
          <div class="filters-container">
            <div class="filter-row">
              <div class="filter-group status-dropdown">
                <div class="dropdown">
                  <button class="dropdown-toggle" (click)="toggleStatusDropdown()">
                    {{ getStatusLabel(selectedStatus) }}
                    <i class="bi bi-chevron-down"></i>
                  </button>
                  <div class="dropdown-menu" [class.show]="showStatusDropdown">
                    <button *ngFor="let status of statusFilters"
                      (click)="filterByStatus(status.value); $event.stopPropagation()">
                      <i class="bi" [class]="getStatusIconClass(status.value)" 
                         [ngClass]="{
                           'icon-approved': status.value.toLowerCase() === 'approved',
                           'icon-rejected': status.value.toLowerCase() === 'rejected'
                         }">
                      </i>
                      {{ status.label }}
                    </button>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <div class="dropdown">
                  <button class="dropdown-toggle" (click)="toggleTypeDropdown()">
                    {{ getTypeLabel(selectedType) }}
                    <i class="bi bi-chevron-down text-warning"></i>
                  </button>
                  <div class="dropdown-menu" [class.show]="showTypeDropdown">
                    <button *ngFor="let type of typeFilters" (click)="filterByType(type.value); $event.stopPropagation()">
                      <i class="bi text-warning" [class]="getTypeIconClass(type.value)"></i>
                      {{ type.label }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="total-records" *ngIf="filteredHistory.length > 0">{{ filteredHistory.length }} records found</div>
            <div class="no-records-message" *ngIf="filteredHistory.length === 0">No records match the selected filters</div>
          </div>
        </div>
      </div>

      <div class="history-table">
        <div class="table-header">
          <div class="request-col">Employee</div>
          <div class="leave-type-col">Leave Type</div>
          <div class="reason-col">Reason</div>
          <div class="date-col">Applied Date</div>
          <div class="status-col">Status</div>
          <div class="actions-col">Actions</div>
        </div>
        <div class="table-body">
          <ng-container *ngIf="filteredHistory.length > 0; else noDataTemplate">
            <div class="table-row" *ngFor="let item of filteredHistory">
              <div class="request-cell">
                <strong *ngIf="!isSingleView">{{ item.name || 'N/A' }}</strong>
              </div>
              <div class="leave-type-cell">
                {{ (item.type || 'N/A').replace(' - PENDING', '').replace(' - APPROVED', '').replace(' - REJECTED', '') }}
              </div>
              <div class="reason-cell">{{ item.reason || 'N/A' }}</div>
              <div class="date-cell">{{ (item.appliedDate || item.submittedOn || '') | date:'mediumDate' }}</div>
              <div class="status-cell">
                <span class="status-badge" [class]="getStatusClass(item.status)">
                  <i class="bi" [class]="getStatusIconClass(item.status?.toLowerCase() || '')"></i>
                  {{ getStatusLabel(item.status) }}
                </span>
              </div>
              <div class="actions-cell">
                <button *ngIf="item.status === 'PENDING'" 
                        class="btn btn-sm btn-success me-2" 
                        (click)="approveLeave(item)"
                        [disabled]="isProcessing">
                  <i class="bi bi-check-lg"></i> Approve
                </button>
                <button *ngIf="item.status === 'PENDING'" 
                        class="btn btn-sm btn-danger" 
                        (click)="rejectLeave(item)"
                        [disabled]="isProcessing">
                  <i class="bi bi-x-lg"></i> Reject
                </button>
                <span *ngIf="item.status !== 'PENDING'" class="text-muted">
                  {{ item.status }}
                </span>
              </div>
            </div>
          </ng-container>
          <ng-template #noDataTemplate>
            <div class="no-data-message">
              <i class="bi bi-inbox text-muted"></i>
              <p>No data available</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>