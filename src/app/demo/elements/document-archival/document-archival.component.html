<div class="documents-container">
  <div class="header">
    <div>
      <h2>Documents</h2>
      <p>Manage and organize all your documents in one place.</p>
    </div>
    <button class="export-btn" (click)="openUploadModal()">
      <i class="fas fa-upload"></i> Upload File
    </button>
  </div>

  <div class="controls">
    <div class="left-controls">
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" 
               placeholder="Search documents..." 
               class="search-box" 
               [(ngModel)]="searchQuery"
               (input)="searchDocuments()" />
      </div>
      <button class="filter-btn">
        <i class="fas fa-filter"></i> Filters
      </button>
    </div>
    <div class="right-controls">
      <select class="file-type" [(ngModel)]="selectedFileType" (change)="filterByType()">
        <option value="">All File Types</option>
        <option value="pdf">PDF</option>
        <option value="docx">Word</option>
        <option value="xlsx">Excel</option>
        <option value="jpg">JPG</option>
        <option value="png">PNG</option>
      </select>

      <select class="year-filter" [(ngModel)]="selectedYear" (change)="filterByYear()">
        <option *ngFor="let year of years" [value]="year">{{year}}</option>
      </select>
    </div>
  </div>

  <table class="document-table">
    <thead>
      <tr class="table-header">
        <th><input type="checkbox" /></th>
        <th>Name</th>
        <th>Uploaded By</th>
        <th>Date Uploaded</th>
        <th>Visibility</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let doc of filteredDocuments">
        <td><input type="checkbox" /></td>
        <td>
          <div class="file-name">
            <i 
              [class]="getFileIconClass(doc.fileName)" 
              [style.color]="getFileIconColor(doc.fileName)"
            ></i>
            <div>
              <div [innerHTML]="highlightMatches(doc.userInputFileName || doc.fileName)"></div>
              <small>{{ formatFileSize(doc.fileSize) }} â€¢ {{doc.fileType}}</small>
            </div>
          </div>
        </td>
        <td [innerHTML]="highlightMatches(doc.uploadedBy)"></td>
        <td>{{ formatDate(doc.uploadDate) }}</td>
        <td>{{ doc.visibleOnlyToMe ? 'Private' : 'Public' }}</td>
        <td class="actions">
          <i class="fas fa-eye action-icon" title="View" (click)="viewDocument(doc.documentCode)"></i>
          <i class="fas fa-download action-icon" title="Download" (click)="downloadDocument(doc.documentCode)"></i>
          <i class="fas fa-trash action-icon" title="Delete" (click)="deleteDocument(doc.id)"></i>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Edit Modal -->
  <div class="modal-overlay" *ngIf="showModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Document</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      <div class="modal-body" *ngIf="selectedDocument">
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" [(ngModel)]="selectedDocument.userInputFileName" class="form-control">
        </div>
        <div class="form-group">
          <label>Replace File (optional)</label>
          <div class="file-upload-wrapper">
            <input type="file" (change)="onFileSelected($event)">
            <small *ngIf="selectedFile">Selected: {{selectedFile.name}}</small>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-cancel" (click)="closeModal()">Cancel</button>
        <button class="btn btn-save" (click)="saveChanges()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Upload File Modal -->
  <div class="modal-overlay" *ngIf="showUploadModal">
    <div class="modal-content upload-modal">
      <div class="modal-header">
        <h3>Upload File</h3>
        <button class="close-btn" (click)="closeUploadModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="file-upload-card">
          <div class="file-meta">
            <div class="file-meta-label">Display Name</div>              
            <div>
              <input type="text" [(ngModel)]="fileName" 
                     placeholder="Enter display name for file">
            </div>
          </div>
          
          <div class="upload-area" (click)="fileInput.click()">
            <input #fileInput type="file" class="file-input" (change)="onFileSelected($event)">
            <div class="upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="upload-instructions">
              <button class="browse-btn" type="button">Choose file</button>
              <div class="drag-text">or drag and drop your file here</div>
              <small *ngIf="selectedFile">Selected: {{selectedFile.name}} ({{formatFileSize(selectedFile.size)}})</small>
            </div>
          </div>

          <div class="visibility-toggle">
            <label>
              <input type="checkbox" [(ngModel)]="visibleOnlyToMe">
              Make this document private (visible only to me)
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-upload" [disabled]="!selectedFile" (click)="uploadFile()">Upload</button>
        <button class="btn btn-cancel" (click)="closeUploadModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>